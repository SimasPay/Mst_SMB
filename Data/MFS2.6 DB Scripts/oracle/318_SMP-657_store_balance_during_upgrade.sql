CREATE TABLE "SUBSCRIBER_UPGRADE_BALANCE_LOG" (
    "ID" NUMBER(19,0) NOT NULL,
    "SUBSCRIBERID" NUMBER(19,0),
    "POCKET_BALANCE" VARCHAR2(255),
    "TXNDATE" DATE
);

ALTER TABLE SUBSCRIBER_UPGRADE_BALANCE_LOG ADD CONSTRAINT "PK_SUBS_UPGRADE_BALANCE_LOG" PRIMARY KEY("ID");
ALTER TABLE SUBSCRIBER_UPGRADE_BALANCE_LOG MODIFY "TXNDATE" TIMESTAMP;

CREATE SEQUENCE SUBSUPGRADE_BALANCELOG_ID_SEQ  MINVALUE 1 MAXVALUE 999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE;

CREATE OR REPLACE TRIGGER SUBSUPGRADE_BALANCELOG_ID_TRG BEFORE INSERT ON SUBSCRIBER_UPGRADE_BALANCE_LOG
FOR EACH ROW
DECLARE
v_newVal NUMBER(12) := 0;
v_incval NUMBER(12) := 0;
BEGIN
  IF INSERTING AND :new.ID IS NULL THEN
    SELECT  SUBSUPGRADE_BALANCELOG_ID_SEQ.NEXTVAL INTO v_newVal FROM DUAL;
    IF v_newVal = 1 THEN
      SELECT NVL(max(ID),0) INTO v_newVal FROM subscriber;
      v_newVal := v_newVal + 1;
      LOOP
           EXIT WHEN v_incval>=v_newVal;
           SELECT SUBSUPGRADE_BALANCELOG_ID_SEQ.nextval INTO v_incval FROM dual;
      END LOOP;
    END IF;
   :new.ID := v_newVal;
  END IF;
END;
/
commit;