var url="";var appConfig={};var isTouchDevice=false;$('div[data-role="page"]').live('pagehide', function(event, ui) {$(event.currentTarget).remove();});$(document).bind("pagechange", function(event, obj) {});$( document ).bind( "mobileinit", function() {$.mobile.allowCrossDomainPages = true;});if (!String.prototype.trim) {String.prototype.trim=function(){return this.replace(/^\s\s*/, '').replace(/\s\s*$/, '');};}function setLayout(){var ch= $('.ui-content').height()/2+$('.ui-header').height()+$('.ui-footer').height();var ph= $('.ui-page').height()/2;$('.ui-content').css("margin-top",(ph>ch?ph-ch:3)+"px");$('.ui-footer').css('position','absolute');}PARAMETER_SERVICE_NAME = "service";PARAMETER_TRANSACTIONNAME = "txnName";PARAMETER_SOURCE_MDN = "sourceMDN";PARAMETER_NEW_PIN = "newPIN";PARAMETER_OTP = "otp";PARAMETER_CHANNEL_ID = "channelID";PARAMETER_CONFIRM_PIN = "confirmPIN";PARAMETER_CHARGES = "charges";PARAMETER_SOURCE_PIN = "sourcePIN";PARAMETER_DEST_MDN = "destMDN";PARAMETER_AMOUNT = "amount";PARAMETER_OLD_PIN = "oldPIN";PARAMETER_SECRET_ANSWER = "secretAnswer";PARAMETER_PARTNER_CODE = "partnerCode";PARAMETER_AGENT_CODE = "agentCode";PARAMETER_MERCHANT_CODE = "merchantCode";PARAMETER_BUCKET_TYPE = "bucketType";PARAMETER_SRC_POCKET_CODE = "sourcePocketCode";PARAMETER_CARDPAN_SUFFIX = "cardPANSuffix";PARAMETER_SRC_MESSAGE = "sourceMessage";PARAMETER_DEST_POCKET_CODE = "destPocketCode";PARAMETER_TRANSFER_ID = "transferID";PARAMETER_CONFIRMED = "confirmed";PARAMETER_PARENTTXN_ID = "parentTxnID";PARAMETER_ISDEFAULT = "isDefault";PARAMETER_BANK_ID = "bankID";PARAMETER_BILLER_NAME = "billerName";PARAMETER_CUSTOMER_ID = "customerID";PARAMETER_BILL_DETAILS = "billDetails";PARAMETER_DATA = "data";PARAMETER_MFS_BILLER_CODE = "mfsBillerCode";PARAMETER_INVOICE_NO = "invoiceNo";PARAMETER_SUB_MDN = "subMDN";PARAMETER_SUB_FIRSTNAME = "subFirstName";PARAMETER_SUB_LASTNAME = "subLastName";PARAMETER_ACCOUNT_TYPE = "accountType";PARAMETER_APPLICATION_ID = "appId";PARAMETER_DOB = "dob";PARAMETER_ACTIVATION_NEWPIN = "activationNewPin";PARAMETER_ACTIVATION_CONFIRMPIN = "activationConfirmPin";PARAMETER_AUTHENTICATION_STRING = "authenticationString";PARAMETER_SUBSCRIBER_MDN = "subscriberMDN";PARAMETER_BILLER_CODE = "billerCode";PARAMETER_BILL_NO = "billNo";PARAMETER_KYC_TYPE = "kycType";PARAMETER_DEST_BANK_CODE = "destBankCode";PARAMETER_DEST_ACCOUNT_NO = "destAccountNo";PARAMETER_DESTINATION_BANK_ACCOUNT_NO = "destBankAccount";PARAMETER_SECRETE_CODE = "secreteCode";PARAMETER_APPTYPE = "apptype";PARAMETER_APPVERSION = "appversion";PARAMETER_APPOS = "appos";PARAMETER_CREDIT_AMT = "creditamt";DUMMY_BANK_ID = "Not Yet";CONSTANT_VALUE_TRUE = "true";CONSTANT_VALUE_FALSE = "false";COMPANY_ID = "companyID";POCKET_CODE_SVA = "1";POCKET_CODE_BANK = "2";SERVICE_ACCOUNT = "Account";SERVICE_WALLET = "Wallet";SERVICE_BANK = "Bank";SERVICE_AGENT = "AgentServices";SERVICE_SHOPPING = "Shopping";SERVICE_BUY = "Buy";SERVICE_PAYMENT = "Payment";TRANSACTION_LOGIN = "Login";TRANSACTION_LOGOUT = "Logout";TRANSACTION_ACTIVATION = "Activation";TRANSACTION_TRANSACTIONSTATUS = "TransactionStatus";TRANSACTION_CHANGEPIN = "ChangePIN";TRANSACTION_RESETPIN = "ResetPIN";TRANSACTION_AGENTACTIVATION = "AgentActivation";TRANSACTION_CHECKBALANCE = "CheckBalance";TRANSACTION_HISTORY = "History";TRANSACTION_TRANSFER = "Transfer";TRANSACTION_TRANSFER_UNREGISTERED = "TransferToUnregistered";TRANSACTION_CASHOUT = "CashOut";TRANSACTION_CASHOUT_UNREGISTERED = "CashOutToUnregistered";TRANSACTION_SUBSCRIBERREGISTRATION = "SubscriberRegistration";TRANSACTION_SUBSCRIBER_REGISTRATION_THROUGH_WEB = "SubscriberRegistrationThroughWeb";TRANSACTION_CASHIN = "CashIn";TRANSACTION_ATM_CASHOUT="CashOutAtATM";TRANSACTION_PURCHASE = "Purchase";TRANSACTION_AGENT_TO_AGENT_TRANSFER = "AgentToAgentTransfer";TRANSACTION_BILL_PAY = "BillPay";TRANSACTION_AIRTIME_PURCHASE = "AirtimePurchase";TRANSACTION_SEND_RECEIPT = "SendReceipt";TRANSACTION_TRANSFER_INQUIRY = "TransferInquiry";TRANSACTION_CASHIN_INQUIRY = "CashInInquiry";TRANSACTION_CASHOUT_INQUIRY = "CashOutInquiry";TRANSACTION_PURCHASE_INQUIRY = "PurchaseInquiry";TRANSACTION_AGENT_AGENT_TRANSFER_INQUIRY = "AgentToAgentTransferInquiry";TRANSACTION_BILL_PAY_INQUIRY = "BillPayInquiry";TRANSACTION_AIRTIME_PURCHASE_INQUIRY = "AirtimePurchaseInquiry";TRANSACTION_INTERBANK_TRANSFER_INQUIRY = "InterBankTransferInquiry";TRANSACTION_INTERBANK_TRANSFER = "InterBankTransfer";TRANSACTION_CASHOUT_UNREGISTERED_INQUIRY = "CashOutInquiryToUnregistered";TRANSACTION_AGENT_BILL_PAY_INQUIRY = "AgentBillPayInquiry";TRANSACTION_AGENT_BILL_PAY = "AgentBillPay";USER_SUBSCRIBER = 0;USER_AGENT = 2;CODE_LOGIN_SUCCESS = "630";CODE_SESSION_EXPIRED = "631";CODE_LOGOUT_SUCCESS = "632";CODE_TRANSFERINQUIRY_UNREGISTERED_SUCCESS = "676";CODE_TRANSFERINQUIRY_SUCCESS = "72";CODE_TRANSFER_UNREGISTERED_PROMPT = "687";CODE_AIRTIME_INQUIRY_SUCCESS = "660";CODE_CASHOUT_UNREGISTERED_INQUIRY_SUCCESS = "677";var validations={};validations[PARAMETER_SOURCE_MDN]="required  minlength='10' maxlength='13' digits=true";validations[PARAMETER_DEST_MDN]="required  minlength='10' maxlength='13' digits=true";validations[PARAMETER_SUB_MDN]="required  minlength='10' maxlength='13' digits=true";validations[PARAMETER_AUTHENTICATION_STRING]="required minlength='4' maxlength='4' digits=true";validations[PARAMETER_ACTIVATION_NEWPIN]="required minlength='4' maxlength='4' digits=true";validations[PARAMETER_ACTIVATION_CONFIRMPIN]="required minlength='4' maxlength='4' digits=true  equalTo='#"+PARAMETER_ACTIVATION_NEWPIN+"'";validations[PARAMETER_OLD_PIN]="required minlength='4' maxlength='4' digits=true";validations[PARAMETER_OTP]="required minlength='4' maxlength='4' digits=true";validations[PARAMETER_NEW_PIN]="required minlength='4' maxlength='4' digits=true";validations[PARAMETER_CONFIRM_PIN]="required minlength='4' maxlength='4' digits=true  equalTo='#"+PARAMETER_NEW_PIN+"'";validations[PARAMETER_SOURCE_PIN]="required minlength='4' maxlength='4' digits=true";validations[PARAMETER_DESTINATION_BANK_ACCOUNT_NO]="required minlength='10' maxlength='10' digits=true ";validations[PARAMETER_DEST_ACCOUNT_NO]="required minlength='10' maxlength='10' digits=true ";validations[PARAMETER_AGENT_CODE]="required ";validations[PARAMETER_BILLER_CODE]="required ";validations[PARAMETER_PARTNER_CODE]="required ";validations[PARAMETER_AMOUNT]="required digits=true";validations[PARAMETER_BILL_NO]="required minlength='10' maxlength='10'";validations[PARAMETER_SUB_FIRSTNAME]="required ";validations[PARAMETER_SUB_LASTNAME]="required ";validations[PARAMETER_DOB]="required date=true ";validations[PARAMETER_APPLICATION_ID]="required maxlength='13' digits=true ";validations[PARAMETER_SECRETE_CODE]="required minlength='4' maxlength='4' digits=true ";validations[PARAMETER_DEST_BANK_CODE]="required  digits=true ";validations[PARAMETER_TRANSFER_ID]="required  digits=true ";var fieldMasks={};fieldMasks[PARAMETER_SOURCE_MDN]="9?999999999999";fieldMasks[PARAMETER_DEST_MDN]="9?999999999999";fieldMasks[PARAMETER_SUB_MDN]="9?999999999999";fieldMasks[PARAMETER_AUTHENTICATION_STRING]="9?999";fieldMasks[PARAMETER_ACTIVATION_NEWPIN]="9?999";fieldMasks[PARAMETER_ACTIVATION_CONFIRMPIN]="9?999";fieldMasks[PARAMETER_OLD_PIN]="9?999";fieldMasks[PARAMETER_NEW_PIN]="9?999";fieldMasks[PARAMETER_CONFIRM_PIN]="9?999";fieldMasks[PARAMETER_SOURCE_PIN]="9?999";fieldMasks[PARAMETER_DESTINATION_BANK_ACCOUNT_NO]="9?999999999";fieldMasks[PARAMETER_DEST_ACCOUNT_NO]="9?999999999";fieldMasks[PARAMETER_AGENT_CODE]='*?************';fieldMasks[PARAMETER_BILLER_CODE]='*?************';fieldMasks[PARAMETER_PARTNER_CODE]='*?************';fieldMasks[PARAMETER_AMOUNT]="9?9999999";fieldMasks[PARAMETER_BILL_NO]="9?999999999";fieldMasks[PARAMETER_SUB_FIRSTNAME]='*?************';fieldMasks[PARAMETER_SUB_LASTNAME]='*?************';fieldMasks[PARAMETER_DOB]="99999999";fieldMasks[PARAMETER_APPLICATION_ID]="9?999999999999";fieldMasks[PARAMETER_SECRETE_CODE]="9?999";fieldMasks[PARAMETER_DEST_BANK_CODE]="9?999";fieldMasks[PARAMETER_TRANSFER_ID]="9?99999999999";fieldMasks[PARAMETER_OTP]="9?999";tpl = {templates:{},loadTemplates:function (names, callback) {var that = this;var loadTemplate = function (index) {var name = names[index];console.log('Loading template: ' + name);$.get('tpl/' + name + '.html', function (data) {that.templates[name] = data;index++;if (index < names.length) {loadTemplate(index);} else {callback();}});};loadTemplate(0);},loadConfig:function (configFile,callback) {var that = this;console.log('Loading config: ' + name);$.get(configFile, function (data,status,response) {that.templates['Config'] = response.responseText;if(that.get('Config')){loadAppConfig();url=appConfig['url'];}labels = new Labels();buttonLabels=new ButtonLabel();callback();}).error(function() {alert("Config file is missing please reinstall application");});},get:function (name) {return this.templates[name];}};function loadAppConfig(){var config = tpl.get('Config');var appConfigPairs = config.split('\n');for(i=0;i<appConfigPairs.length;i++){if(appConfigPairs[i].indexOf(':')!=-1){var param = appConfigPairs[i].substring(0,appConfigPairs[i].indexOf(':'));var value =  appConfigPairs[i].substring(appConfigPairs[i].indexOf(':')+1,appConfigPairs[i].length);appConfig[param.trim()]=value.trim();}}}function setRequestData(data){app.request.clear();var paramValuePairs = data.split('&');for(i=0;i<paramValuePairs.length;i++){var paramValue = paramValuePairs[i].split('=');app.request.set(paramValue[0],paramValue[1]);}}function sendRequest(data,view)  {disablePage();setRequestData(data);app.response.clear();$.ajax({type: "POST",dataType: 'jsonp',jsonpCallback: "callback",url: url,cache: false,data: data,timeout:10000,success: function(response){enablePage();if(response.data.code ==CODE_SESSION_EXPIRED){alert("Your session has expired please login again");app.user.clear();app.request.clear();app.main();}else{view.onSuccess(response);}},error: onError});}function sendLogoutRequest()  {disablePage();app.response.clear();var data = PARAMETER_SERVICE_NAME+"="+SERVICE_ACCOUNT+"&"+PARAMETER_TRANSACTIONNAME+"="+TRANSACTION_LOGOUT+"&"+PARAMETER_SOURCE_MDN+"="+app.user.get(PARAMETER_SOURCE_MDN)+"&"+PARAMETER_AUTHENTICATION_STRING+"="+app.user.get(PARAMETER_AUTHENTICATION_STRING);$.ajax({type: "POST",dataType: 'jsonp',jsonpCallback: "callback",url: url,cache: false,data: data,timeout:60000,success: onLogout,error: onLogout});}function onLogout(){enablePage();app.user.clear();app.request.clear();app.main();}function onError(jqXHR, textStatus, errorThrown){enablePage();var response={};var viewResponse = true;if (jqXHR.status === 0) {viewResponse = false;alert('Not connected to Server.\n Verify Network connectivity.');} else if (jqXHR.status == 404) {response.message='Requested page not found.';} else if (jqXHR.status == 500) {response.message='Internal Server Error. Try again later';} else if (textStatus === 'parsererror') {response.message='Invalid response please contact customer care.';} else if (textStatus === 'timeout') {response.message='Your request timed out please try again';} else if (textStatus === 'abort') {response.message='Your request aborted please try again';} else {response.message='Unknow error \n' + jqXHR.responseText;}if(viewResponse){var error = new ResponseView(response);app.changePage(error);}}function disablePage(){$.mobile.showPageLoadingMsg();$('input,button').attr('disabled', true);$('.ui-select').bind('click', false);}function enablePage(){$.mobile.hidePageLoadingMsg();$('input,button').attr('disabled', false);$('.ui-select').unbind('click', false);}function addField(config){var field ="<br>";if(config.label){var required = config.required?"<span class='requiredColor'>*</span>":"&nbsp;";field = field+"<label for="+config.name+" >"+required+"<b>"+labels.getLabel(config.name,config.label)+"</b></label>";}field=field+" <input  id='"+config.name+"' name='"+config.name+"'  type='"+config.type+"'";if(config.value) {field=field+" value='"+config.value+"'";}if(config.validations){field=field+" class="+validations[config.name];}if(config.type=='text'||config.type=='password'){field=field+" placeholder='"+getPlaceHolder(config.name)+"'";}field = field+" />"; return field;}function addHiddenField(config){return "<input data-mini='true' id='"+config.name+"' name='"+config.name+"'  type='hidden' value='"+config.value+"'>";}function addButton(config){var type = "button";if(config.type){type = config.type;}var button = "<br><input value ='"+buttonLabels.getButtonLabel(config.id,config.value)+"' type='"+type+"'";if(config.id){button=button+" id='"+config.id+"'" ;}if(config.inline){}if(config.icon){button=button+" data-icon="+config.icon;}return button+"  class='ui-btn-center' data-mini='true'/>" ;}function addMenuItem(config){var button = "<br><input value ='"+buttonLabels.getButtonLabel(config.id,config.text)+"' type='button'";if(config.id){button=button+" id='"+config.id+"'" ;}return button+" class='ui-btn-center' data-mini='true'/>" ;}function isValidDate(date){var dayfield=date.substring(0,2);var monthfield=date.substring(3,5);var yearfield=date.substring(6,10);var dayobj = new Date(yearfield, monthfield-1, dayfield);if ((dayobj.getMonth()+1!=monthfield)||(dayobj.getDate()!=dayfield)||(dayobj.getFullYear()!=yearfield)){return false;}else{return true;}}function getEvents(clickevents,touchevents){return isTouchDevice?touchevents:clickevents;}function getPlaceHolder(name){if(fieldMasks[name].indexOf('*')!=-1){return 'Enter Alphanumeric values only';}else if(fieldMasks[name].indexOf('9')!=-1){return 'Enter only digits';}else{return '';}}$.validator.addMethod("noSpecialCharacters", function(value, element) {if (/^[A-Za-z0-9 ]{0,100}$/.test(value)) {return true} else {return false}});window.Request = Backbone.Model.extend({urlRoot:url,initialize:function () {}});window.Response = Backbone.Model.extend({urlRoot:url,initialize:function () {}});window.User = Backbone.Model.extend({urlRoot:url,initialize:function () {}});window.Labels = Backbone.Model.extend({urlRoot:url,initialize:function () {var labels= this;$.ajax({type: "GET",url: "labels.xml",dataType: "xml",success: function(xml){$(xml).find("Labels").each(function(){$(this).children().each(function(){labels.set(this.tagName,$(this).text());});});},error:this.onError});},getLabel:function(name,label){if(this.get(name)){return this.get(name);}else{return label;}},onError:function(){console.log("failed to load xml");}});window.ButtonLabel = Backbone.Model.extend({urlRoot:url,initialize:function () {var ButtonLabel= this;$.ajax({type: "GET",url: "ButtonLabel.xml",dataType: "xml",success: function(xml){console.log("but");$(xml).find("ButtonLabel").each(function(){$(this).children().each(function(){ButtonLabel.set(this.tagName,$(this).text());});});},error:this.onError});},getButtonLabel:function(id,text){if(this.get(id)){return this.get(id);}else{return text;}},onError:function(){console.log("failed to load xml");}});window.IndexMenuPage = Backbone.View.extend({initialize:function () {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#content', this.el).append(addMenuItem({id:"Login",text:"Login"})+addMenuItem({id:"Activation",text:"Activation"}));$('#back', this.el).remove();$('#home', this.el).remove();$('#logout', this.el).remove();this.events=getEvents({'click #Login':   'showLoginForm','click #Activation':   'showActivationForm'},{'touchstart #Login':   'showLoginForm','touchstart #Activation':   'showActivationForm'});},render:function (eventName) {return this;},showLoginForm:function (e) {var loginForm = new LoginPage();app.changePage(loginForm);},showActivationForm:function(e){var activationForm = new ActivationPage();app.changePage(activationForm);}});window.LoginPage = Backbone.View.extend({initialize:function () {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#baseForm', this.el).append(addField({label:"MobileNumber",name:PARAMETER_SOURCE_MDN,type:"text",required:true,validations:true})+addField({label:"PIN",name:PARAMETER_AUTHENTICATION_STRING,type:"password",required:true,validations:true})+addHiddenField({name:PARAMETER_TRANSACTIONNAME,type:"hidden",value:TRANSACTION_LOGIN})+addHiddenField({name:PARAMETER_SERVICE_NAME,type:"hidden",value:SERVICE_ACCOUNT})+addButton({value:"Login",type:"submit",inline:true}));$('#home', this.el).remove();$('#logout', this.el).remove();this.events=getEvents({'click #back' : 'cancel','submit form':   'submit'},{'touchstart #back':   'cancel','submit form':   'submit'});},render:function (eventName) {return this;},cancel:function(){app.main();},submit : function() {if($('#baseForm').valid()){var self = this;var data = $('#baseForm').serialize();sendRequest(data, self);}return false;},onSuccess:function(response){if(response.data.code==CODE_LOGIN_SUCCESS){app.user.set(response.data);app.user.set(PARAMETER_SOURCE_MDN,app.request.get(PARAMETER_SOURCE_MDN));app.user.set(PARAMETER_AUTHENTICATION_STRING,app.request.get(PARAMETER_AUTHENTICATION_STRING));if(response.data.url!="-1"){var update = new UpdateApp(response.data.url);app.changePage(update);}else{app.menu();}}else{alert(response.data.message);app.user.clear();}}});window.UpdateApp = Backbone.View.extend({initialize:function (appurl) {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#baseForm', this.el).append("<b>A new updated version available <br>"+"<br><a href='"+appurl+"' data-role='button' data-mini='true'>Update</a>"+addButton({value:"Cancel",id:'Cancel',type:"button",inline:true}));$('#home', this.el).remove();$('#logout', this.el).remove();this.events=getEvents({'click #Cancel' : 'cancel'},{'touchstart #Cancel':   'cancel'});},render:function (eventName) {return this;},cancel:function(){app.menu();}});window.ActivationPage = Backbone.View.extend({initialize:function () {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#baseForm', this.el).append(addHiddenField({name:PARAMETER_SERVICE_NAME,type:"hidden",value:SERVICE_ACCOUNT})+addField({label:"MDN",name:PARAMETER_SOURCE_MDN,type:"text",required:true,validations:true})+addField({label:"OneTimePin",name:PARAMETER_OTP,type:"password",required:true,validations:true})+addField({label:"NewPin",name:PARAMETER_ACTIVATION_NEWPIN,type:"password",required:true,validations:true})+addField({label:"ConfirmPin",name:PARAMETER_ACTIVATION_CONFIRMPIN,type:"password",required:true,validations:true})+"<br><fieldset data-role='controlgroup' data-type='horizontal' align='center'>" +"<input type='radio' name='"+PARAMETER_TRANSACTIONNAME+"' id='subscriberOption' value='"+TRANSACTION_ACTIVATION+"' checked='checked' />" +"<label for='subscriberOption'>Subscriber</label>" +"<input type='radio' name='"+PARAMETER_TRANSACTIONNAME+"' id='agentOption' value='"+TRANSACTION_AGENTACTIVATION+"'  />" +"<label for='agentOption'>Agent</label>" +"</fieldset>"+addButton({id:"activate",value:"Activate",type:"submit",inline:true}));$('#home', this.el).remove();$('#logout', this.el).remove();this.events=getEvents({'click #back' : 'cancel','submit form':   'submit'},{'touchstart #back' : 'cancel','touchstart form':   'submit'});},render:function (eventName) {return this;},cancel:function(){app.main();},submit:function(){if($('#baseForm').valid()){var self = this;var data = $('#baseForm').serialize();sendRequest(data,self);}return false;},onSuccess:function(response){var responseview= new ResponseView(response);app.changePage(responseview);}});window.ResponseView = Backbone.View.extend({initialize:function (response) {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());if(response.data){$('#content', this.el).append("<center>("+response.data.code+") "+response.data.message);}else{$('#content', this.el).append("<center>"+response.message);}$('#content', this.el).append(addButton({id:"ok",value:"OK",inline:true}));if(!app.user.has(PARAMETER_SOURCE_MDN)){$('#home', this.el).remove();}$('#logout', this.el).remove();$('#back', this.el).remove();this.events=getEvents({'click #logout' : 'logout','click #home' : 'home','click #ok' : 'back'},{'touchstart #logout' : 'logout','touchstart #home' : 'home','touchstart #ok' : 'back'});},render:function (eventName) {return this;},logout:function(){app.logout();},home:function(){app.menu();},back:function(){app.menu();}});window.SubscriberMenu = Backbone.View.extend({initialize:function () {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#content', this.el).append(addMenuItem({id:"TransferMenu",text:"Transfer"})+addMenuItem({id:"BuyMe",text:"Buy"})+addMenuItem({id:"Bill",text:"Bill Payment"})+addMenuItem({id:"Account",text:"Account"}));$('#back', this.el).remove();$('#home', this.el).remove();this.events=getEvents({'click #logout':   'logout','click #TransferMenu':   'showTransferMenu','click #BuyMe'  : 'showBuyMenu','click #Bill'  : 'showBillPaymentMenu','click #Account'  : 'showAccountMenu'},{'touchstart #logout':   'logout','touchstart #TransferMenu':   'showTransferMenu','touchstart #BuyMe'  : 'showBuyMenu','touchstart #Bill'  : 'showBillPaymentMenu','touchstart #Account'  : 'showAccountMenu'});},render:function (eventName) {return this;},logout:function (e) {app.logout();},showTransferMenu:function(e){var transferMenu = new TransferMenu();app.changePage(transferMenu);},showBuyMenu:function(e){var buyMenu = new BuyMenu();app.changePage(buyMenu);},showBillPaymentMenu:function(e){var billPaymentMenu = new BillPaymentMenu();app.changePage(billPaymentMenu);},showAccountMenu:function(e){var accountMenu = new AccountMenu();app.changePage(accountMenu);}});window.TransferMenu = Backbone.View.extend({initialize:function () {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#content', this.el).append(addMenuItem({id:"SelfTransfer",text:"Self"})+addMenuItem({id:"OthersTransfer",text:"Others"}));$('#logout', this.el).remove();$('#home', this.el).remove();this.events=getEvents({'click #logout':   'logout','click #home':   'home','click #back':   'back','click #SelfTransfer':   'showSelfTransferMenu','click #OthersTransfer':   'showOthersTransferMenu'},{'touchstart #logout':   'logout','touchstart #home':   'home','touchstart #back':   'back','touchstart #SelfTransfer':   'showSelfTransferMenu','touchstart #OthersTransfer':   'showOthersTransferMenu'});},render:function (eventName) {return this;},logout:function (e) {app.logout();},home:function(e){app.menu();},back:function(e){app.menu();},showSelfTransferMenu:function(){var transferMenu = new SelfTransferMenu();app.changePage(transferMenu);},showOthersTransferMenu:function(){var transferMenu = new OthersTransferMenu();app.changePage(transferMenu);}});window.SelfTransferMenu = Backbone.View.extend({initialize:function () {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#content', this.el).append(addMenuItem({id:"EmoneyToBank",text:"EmoneyToBank"})+addMenuItem({id:"BankToEmoney",text:"BankToEmoney"}));$('#logout', this.el).remove();this.events=getEvents({'click #logout':   'logout','click #home':   'home','click #back':   'back','click #EmoneyToBank':   'showEmoneyToBankForm','click #BankToEmoney':   'showBankToEmoneyForm'},{'touchstart #logout':   'logout','touchstart #home':   'home','touchstart #back':   'back','touchstart #EmoneyToBank':   'showEmoneyToBankForm','touchstart #BankToEmoney':   'showBankToEmoneyForm'});},render:function (eventName) {return this;},logout:function (e) {app.logout();},home:function(e){app.menu();},back:function(e){var transferMenu = new TransferMenu();app.changePage(transferMenu);},showEmoneyToBankForm:function(){var back = new SelfTransferMenu();var transferInquiryForm = new TransferInquiryForm({srcPocketCode:POCKET_CODE_SVA,destPocketCode:POCKET_CODE_BANK,isSelfTransfer:true,back:back});app.changePage(transferInquiryForm);},showBankToEmoneyForm:function(){var back = new SelfTransferMenu();var transferInquiryForm = new TransferInquiryForm({srcPocketCode:POCKET_CODE_BANK,destPocketCode:POCKET_CODE_SVA,isSelfTransfer:true,back:back});app.changePage(transferInquiryForm);}});window.OthersTransferMenu = Backbone.View.extend({initialize:function () {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#content', this.el).append(addMenuItem({id:"EmoneyToEmoeny",text:"EmoneyToEmoeny"})+addMenuItem({id:"EmoneyToBankOther",text:"EmoneyToBank"})+addMenuItem({id:"BankToEmoneyOther",text:"BankToEmoney"})+addMenuItem({id:"BankToBank",text:"BankToBank"}));$('#logout', this.el).remove();this.events=getEvents({'click #logout':   'logout','click #home':   'home','click #back':   'back','click #EmoneyToEmoeny':   'showEmoneyToEmoenyForm','click #EmoneyToBankOther':   'showEmoneyToBankForm','click #BankToEmoneyOther':   'showBankToEmoneyForm','click #BankToBank':   'showBankToBankForm'},{'touchstart #logout':   'logout','touchstart #home':   'home','touchstart #back':   'back','touchstart #EmoneyToEmoeny':   'showEmoneyToEmoenyForm','touchstart #EmoneyToBankOther':   'showEmoneyToBankForm','touchstart #BankToEmoneyOther':   'showBankToEmoneyForm','touchstart #BankToBank':   'showBankToBankForm'});},render:function (eventName) {return this;},logout:function (e) {app.logout();},home:function(e){app.menu();},back:function(e){var transferMenu = new TransferMenu();app.changePage(transferMenu);},showEmoneyToEmoenyForm:function(){var transferMenu = new OthersTransferMenu();var transferInquiryForm = new TransferInquiryForm({srcPocketCode:POCKET_CODE_SVA,destPocketCode:POCKET_CODE_SVA,isSelfTransfer:false,back:transferMenu});app.changePage(transferInquiryForm);},showEmoneyToBankForm:function(){var transferMenu = new OthersTransferMenu();var transferInquiryForm = new TransferInquiryForm({srcPocketCode:POCKET_CODE_SVA,destPocketCode:POCKET_CODE_BANK,isSelfTransfer:false,back:transferMenu});app.changePage(transferInquiryForm);},showBankToEmoneyForm:function(){var transferMenu = new OthersTransferMenu();var transferInquiryForm = new TransferInquiryForm({srcPocketCode:POCKET_CODE_BANK,destPocketCode:POCKET_CODE_SVA,isSelfTransfer:false,back:transferMenu});app.changePage(transferInquiryForm);},showBankToBankForm:function(){var banktobankmenu = new BankToBankMenu();app.changePage(banktobankmenu);}});window.TransferConfirmationForm = Backbone.View.extend({initialize:function (config) {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());var txnName = config.confirmTxnName?config.confirmTxnName:TRANSACTION_TRANSFER;$('#baseForm', this.el).append(addHiddenField({name:PARAMETER_SERVICE_NAME,value:app.request.get(PARAMETER_SERVICE_NAME)})+addHiddenField({name:PARAMETER_SOURCE_MDN,value:app.request.get(PARAMETER_SOURCE_MDN)})+addHiddenField({name:PARAMETER_SRC_POCKET_CODE,value:app.request.get(PARAMETER_SRC_POCKET_CODE)})+addHiddenField({name:PARAMETER_DEST_POCKET_CODE,value:app.request.get(PARAMETER_DEST_POCKET_CODE)})+addHiddenField({name:PARAMETER_TRANSFER_ID,value:app.response.get(PARAMETER_TRANSFER_ID)})+addHiddenField({name:PARAMETER_PARENTTXN_ID,value:app.response.get(PARAMETER_PARENTTXN_ID)})+addHiddenField({name:PARAMETER_TRANSACTIONNAME,value:txnName}));if(config.isAgent){$('#baseForm', this.el).append(addHiddenField({name:PARAMETER_AGENT_CODE,value:app.request.get(PARAMETER_AGENT_CODE)}));}var transfer = txnName==TRANSACTION_CASHIN?"cashin":"transfer";var confirm ="<center><b> Your requested to "+transfer+"<br>";if(app.request.has(PARAMETER_DEST_MDN)){$('#baseForm', this.el).append(addHiddenField({name:PARAMETER_DEST_MDN,value:app.request.get(PARAMETER_DEST_MDN)}));confirm=confirm+(config.isSelfTransfer?"":"<br><b>Receiver phone number\n</b>"+app.request.get(PARAMETER_DEST_MDN));}if(app.request.get(PARAMETER_DESTINATION_BANK_ACCOUNT_NO)){$('#baseForm', this.el).append(addHiddenField({name:PARAMETER_DESTINATION_BANK_ACCOUNT_NO,value:app.request.get(PARAMETER_DESTINATION_BANK_ACCOUNT_NO)}));confirm=confirm+(config.isSelfTransfer?"":"<br><b>Receiver account number\n </b>"+app.request.get(PARAMETER_DESTINATION_BANK_ACCOUNT_NO));}if(app.request.get(PARAMETER_AGENT_CODE)){confirm=confirm+(config.isSelfTransfer?"":"<br><b>Receiver agent code\n </b>"+app.request.get(PARAMETER_AGENT_CODE));}confirm =confirm+"<br><b> Amount\n </b>"+app.response.get(PARAMETER_CREDIT_AMT)+"<br><b> Charge\n </b>"+app.response.get(PARAMETER_CHARGES)+"</center>";$('#baseForm', this.el).append(confirm);$('#baseForm', this.el).append(addButton({id:"confirm",value:"Confirm",type:"submit",inline:true})+addButton({id:"cancel",value:"Cancel",inline:true}));$('#logout', this.el).remove();$('#back', this.el).remove();this.events=getEvents({'click #logout':   'logout','click #home':   'home','click #cancel':   'cancel','submit form':   'submit'},{'touchstart #logout':   'logout','touchstart #home':   'home','touchstart #cancel':   'cancel','submit form':   'submit'});},render:function (eventName) {return this;},logout:function (e) {app.logout();},home:function(e){app.menu();},cancel:function(e){var self = this;var data = $('#baseForm').serialize();data = data+"&confirmed="+CONSTANT_VALUE_FALSE;sendRequest(data,self);},submit:function(){var self = this;var data = $('#baseForm').serialize();data = data+"&confirmed="+CONSTANT_VALUE_TRUE;sendRequest(data,self);return false;},onSuccess:function(response){var error = new ResponseView(response);app.changePage(error);}});window.TransferInquiryForm = Backbone.View.extend({initialize:function (config) {this.template = _.template(tpl.get('basepage'));this.config=config;var txnName = config.txnName?config.txnName:TRANSACTION_TRANSFER_INQUIRY;var service = config.service?config.service:config.srcPocketCode==POCKET_CODE_SVA?SERVICE_WALLET:SERVICE_BANK;var buttonText = txnName==TRANSACTION_CASHIN_INQUIRY?"CashIn":"Transfer";$(this.el).html(this.template());$('#baseForm', this.el).append(addHiddenField({name:PARAMETER_TRANSACTIONNAME,value:txnName})+addHiddenField({name:PARAMETER_SERVICE_NAME,value:service})+addHiddenField({name:PARAMETER_SOURCE_MDN,value:app.user.get(PARAMETER_SOURCE_MDN)})+addHiddenField({name:PARAMETER_SRC_POCKET_CODE,value:config.srcPocketCode})+addHiddenField({name:PARAMETER_DEST_POCKET_CODE,value:config.destPocketCode}));if(config.isSelfTransfer)  {$('#baseForm', this.el).append(addHiddenField({name:PARAMETER_DEST_MDN,value:app.user.get(PARAMETER_SOURCE_MDN),validations:true}));} else{if(config.isAgent){$('#baseForm', this.el).append(addField({label:"AgentCode",name:PARAMETER_AGENT_CODE,type:"text",required:true,validations:true}));}else{if(config.destPocketCode==POCKET_CODE_BANK){if(!config.interbank){$('#baseForm', this.el).append(addField({label:"DestBankAccount",name:PARAMETER_DESTINATION_BANK_ACCOUNT_NO,required:true,type:"text",validations:true}));}}else{$('#baseForm', this.el).append(addField({label:"DestMDN",name:PARAMETER_DEST_MDN,type:"text",required:true,validations:true}));}}}if(config.interbank){$('#baseForm', this.el).append(addField({label:"DestBankAccount",name:PARAMETER_DEST_ACCOUNT_NO,required:true,type:"text",validations:true})+addField({label:"DestinationBankCode",name:PARAMETER_DEST_BANK_CODE,type:"text",required:true,validations:true}));}$('#baseForm', this.el).append(addField({label:"Amount",name:PARAMETER_AMOUNT,type:"text",required:true,validations:true})+addField({label:"PIN",name:PARAMETER_SOURCE_PIN,type:"password",required:true,validations:true})+addButton({id:"transfer",value:buttonText,type:"submit",inline:true}));$('#logout', this.el).remove();this.events=getEvents({'click #logout':   'logout','click #home':   'home','click #back':   'back','submit form':   'submit'},{'touchstart #logout':   'logout','touchstart #home':   'home','touchstart #back':   'back','submit form':   'submit'});},render:function (eventName) {return this;},logout:function (e) {app.logout();},home:function(e){app.menu();},back:function(e){app.changePage(this.config.back);},submit:function(){if($('#baseForm').valid()){var self = this;var data = $('#baseForm').serialize();sendRequest(data,self);}return false;},onSuccess:function(response){var self=this;var code=response.data.code;if(code==CODE_TRANSFERINQUIRY_SUCCESS||code==CODE_TRANSFERINQUIRY_UNREGISTERED_SUCCESS){app.response.set(response.data);var transferConfirmation = new TransferConfirmationForm(self.config);app.changePage(transferConfirmation);}else if(code==CODE_TRANSFER_UNREGISTERED_PROMPT){var unregTransfer = new UnregisteredTransferForm();app.changePage(unregTransfer);}else{var error = new ResponseView(response);app.changePage(error);}}});window.UnregisteredTransferForm = Backbone.View.extend({initialize:function () {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#baseForm', this.el).append(addHiddenField({name:PARAMETER_SERVICE_NAME,value:app.request.get(PARAMETER_SERVICE_NAME)})+addHiddenField({name:PARAMETER_TRANSACTIONNAME,value:app.request.get(PARAMETER_TRANSACTIONNAME)})+addHiddenField({name:PARAMETER_SOURCE_MDN,value:app.request.get(PARAMETER_SOURCE_MDN)})+addHiddenField({name:PARAMETER_SRC_POCKET_CODE,value:app.request.get(PARAMETER_SRC_POCKET_CODE)})+addHiddenField({name:PARAMETER_DEST_POCKET_CODE,value:app.request.get(PARAMETER_DEST_POCKET_CODE)})+addHiddenField({name:PARAMETER_DEST_MDN,value:app.request.get(PARAMETER_DEST_MDN)})+addHiddenField({name:PARAMETER_AMOUNT,value:app.request.get(PARAMETER_AMOUNT)})+addHiddenField({name:PARAMETER_SOURCE_PIN,value:app.request.get(PARAMETER_SOURCE_PIN)})+addField({label:"DestFirstName",name:PARAMETER_SUB_FIRSTNAME,type:"text",required:true,validations:true})+addField({label:"DestLastName",name:PARAMETER_SUB_LASTNAME,type:"text",required:true,validations:true})+addButton({id:"transfer",value:"Transfer",type:"submit",inline:true})+addButton({id:"cancel",value:"Cancel",inline:true}));$('#logout', this.el).remove();$('#back', this.el).remove();this.events=getEvents({'click #logout':   'logout','click #home':   'home','click #cancel':   'home','submit form':   'submit'},{'touchstart #logout':   'logout','touchstart #home':   'home','touchstart #cancel':   'home','submit form':   'submit'});},render:function (eventName) {return this;},logout:function (e) {app.logout();},home:function(e){app.menu();},submit:function(){var self = this;if($('#baseForm').valid()){var data = $('#baseForm').serialize();sendRequest(data,self);}return false;},onSuccess:function(response){var code=response.data.code;if(code==CODE_TRANSFERINQUIRY_UNREGISTERED_SUCCESS){app.response.set(response.data);var transferConfirmation = new TransferConfirmationForm({isSelfTransfer:false});app.changePage(transferConfirmation);}else{var error = new ResponseView(response);app.changePage(error);}}});window.AccountMenu = Backbone.View.extend({initialize : function() {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#content', this.el).append(addMenuItem({id : "ChangePIN",text : "Change PIN"})+addMenuItem({id : "CheckBalance",text : "Check Balance"})+addMenuItem({id : "History",text : "History"}));if(app.user.get("type")!=USER_AGENT){$('#content', this.el).append(addMenuItem({id : "CashOut",text : "Cash Out"}));}$('#logout', this.el).remove();this.events=getEvents({'click #logout' : 'logout','click #home' : 'home','click #back' : 'home','click #ChangePIN' : 'showChangePinForm','click #CheckBalance' : 'showCheckBalanceMenu','click #History' : 'showHistoryMenu','click #CashOut' : 'showCashOutMenu'},{'touchstart #logout' : 'logout','touchstart #home' : 'home','touchstart #back' : 'home','touchstart #ChangePIN' : 'showChangePinForm','touchstart #CheckBalance' : 'showCheckBalanceMenu','touchstart #History' : 'showHistoryMenu','touchstart #CashOut' : 'showCashOutMenu'});},render : function(eventName) {return this;},logout : function(e) {app.logout();},home : function(e) {app.menu();},showChangePinForm : function() {var Menu = new ChangePinForm();app.changePage(Menu);},showCheckBalanceMenu : function() {var Menu = new CheckBalanceMenu();app.changePage(Menu);},showHistoryMenu : function() {var Menu = new HistoryMenu();app.changePage(Menu);},showCashOutMenu : function() {var Menu = new CashOutInquiryForm({sourcePocketCode : POCKET_CODE_SVA});app.changePage(Menu);}});window.ChangePinForm = Backbone.View.extend({initialize : function() {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#baseForm', this.el).append(addHiddenField({name:PARAMETER_SERVICE_NAME,value:SERVICE_ACCOUNT})+addHiddenField({name:PARAMETER_TRANSACTIONNAME,value:TRANSACTION_CHANGEPIN})+addHiddenField({name:PARAMETER_SOURCE_MDN,value:app.user.get(PARAMETER_SOURCE_MDN)})+addField({label : "Old PIN",name : PARAMETER_SOURCE_PIN,type : "password",required : true,validations:true})+addField({label : "New PIN",name : PARAMETER_NEW_PIN,type : "password",required : true,validations:true})+addField({label : "Confirm PIN",name : PARAMETER_CONFIRM_PIN,type : "password",required : true,validations:true})+addButton({id : "submit",value : "Change",type : "submit",inline : true}));$('#logout', this.el).remove();this.events=getEvents({'click #logout' : 'logout','click #home' : 'home','click #back' : 'back','submit form' : 'submit'},{'touchstart #logout' : 'logout','touchstart #home' : 'home','touchstart #back' : 'back','submit form' : 'submit'});},render : function(eventName) {return this;},logout : function(e) {app.logout();},home : function(e) {app.menu();},back : function(e) {var menu = new AccountMenu();app.changePage(menu);},submit : function() {if ($('#baseForm').valid()) {var answer = confirm("Are you sure you want to change your PIN ?");if (answer){var self = this;var data = $('#baseForm').serialize();sendRequest(data, self);}else{this.back();}}return false;},onSuccess : function(response) {var responseView = new ResponseView(response);app.changePage(responseView);}});window.CheckBalanceMenu = Backbone.View.extend({initialize : function() {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#content', this.el).append(addMenuItem({id : "Emoney",text : "Emoney"})+addMenuItem({id : "bank",text : "Bank"}));$('#logout', this.el).remove();this.events=getEvents({'click #logout' : 'logout','click #home' : 'home','click #back' : 'back','click #bank' : 'showBankBalanceForm','click #Emoney' : 'showEmoneyBalanceForm'},{'touchstart #logout' : 'logout','touchstart #home' : 'home','touchstart #back' : 'back','touchstart #bank' : 'showBankBalanceForm','touchstart #Emoney' : 'showEmoneyBalanceForm'});},render : function(eventName) {return this;},logout : function(e) {app.logout();},home : function(e) {app.menu();},back : function(e) {var accMenu = new AccountMenu();app.changePage(accMenu);},showBankBalanceForm : function() {var bankbalanceInquiryForm = new CheckBalanceForm({service : SERVICE_BANK,sourcePocketCode:POCKET_CODE_BANK});app.changePage(bankbalanceInquiryForm);},showEmoneyBalanceForm : function() {var emoneybalanceInquiryForm = new CheckBalanceForm({service : SERVICE_WALLET,sourcePocketCode:POCKET_CODE_SVA});app.changePage(emoneybalanceInquiryForm);}});window.CheckBalanceForm = Backbone.View.extend({initialize : function(config) {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#baseForm', this.el).append(addHiddenField({name : PARAMETER_TRANSACTIONNAME,value : TRANSACTION_CHECKBALANCE})+addHiddenField({name : PARAMETER_SERVICE_NAME,value : config.service})+addHiddenField({name : PARAMETER_SRC_POCKET_CODE,value : config.sourcePocketCode})+addHiddenField({name : PARAMETER_SOURCE_MDN,value : app.user.get(PARAMETER_SOURCE_MDN)})+addField({label : "PIN",name : PARAMETER_SOURCE_PIN,type : "password",required : true,validations:true})+addButton({id : "Submit",value : "Get Balance",type : "submit",inline : true}));$('#logout', this.el).remove();this.events=getEvents({'click #logout' : 'logout','click #home' : 'home','click #back' : 'back','submit form' : 'submit'},{'touchstart #logout' : 'logout','touchstart #home' : 'home','touchstart #back' : 'back','submit form' : 'submit'});},render : function(eventName) {return this;},logout : function(e) {app.logout();},home : function(e) {app.menu();},back : function(e) {var menu = new CheckBalanceMenu();app.changePage(menu);},submit : function() {if($('#baseForm').valid()){var self = this;var data = $('#baseForm').serialize();sendRequest(data, self);}return false;},onSuccess : function(response) {var responseView = new ResponseView(response);app.changePage(responseView);}});window.HistoryMenu = Backbone.View.extend({initialize : function() {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#content', this.el).append(addMenuItem({id : "Emoney",text : "Emoney"})+addMenuItem({id : "bank",text : "Bank"}));$('#logout', this.el).remove();this.events=getEvents({'click #logout' : 'logout','click #home' : 'home','click #back' : 'back','click #bank' : 'showBankHistoryForm','click #Emoney' : 'showEmoneyHistoryForm'},{'touchstart #logout' : 'logout','touchstart #home' : 'home','touchstart #back' : 'back','touchstart #bank' : 'showBankHistoryForm','touchstart #Emoney' : 'showEmoneyHistoryForm'});},render : function(eventName) {return this;},logout : function(e) {app.logout();},home : function(e) {app.menu();},back : function(e) {var accMenu = new AccountMenu();app.changePage(accMenu);},showBankHistoryForm : function() {var bankHistoryInquiryForm = new HistoryInquiryForm({sourcePocketCode : POCKET_CODE_BANK});app.changePage(bankHistoryInquiryForm);},showEmoneyHistoryForm : function() {var emoneyHistoryInquiryForm = new HistoryInquiryForm({sourcePocketCode : POCKET_CODE_SVA});app.changePage(emoneyHistoryInquiryForm);}});window.HistoryInquiryForm = Backbone.View.extend({initialize : function(config) {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());var service =  config.sourcePocketCode == POCKET_CODE_SVA ? SERVICE_WALLET : SERVICE_BANK;$('#baseForm', this.el).append(addHiddenField({name : PARAMETER_TRANSACTIONNAME,value : TRANSACTION_HISTORY})+addHiddenField({name : PARAMETER_SERVICE_NAME,value : service})+addHiddenField({name : PARAMETER_SRC_POCKET_CODE,value : config.sourcePocketCode})+addHiddenField({name : PARAMETER_SOURCE_MDN,value : app.user.get(PARAMETER_SOURCE_MDN)})+addField({label : "PIN",name : PARAMETER_SOURCE_PIN,type : "password",required : true,validations:true})+addButton({id : "Submit",value : "Get History",type : "submit",inline : true}));$('#logout', this.el).remove();this.events=getEvents({'click #logout' : 'logout','click #home' : 'home','click #back' : 'back','submit form' : 'submit'},{'touchstart #logout' : 'logout','touchstart #home' : 'home','touchstart #back' : 'back','submit form' : 'submit'});},render : function(eventName) {return this;},logout : function(e) {app.logout();},home : function(e) {app.menu();},back : function(e) {var menu = new HistoryMenu();app.changePage(menu);},submit : function() {if($('#baseForm').valid()){var self = this;var data = $('#baseForm').serialize();sendRequest(data, self);}return false;},onSuccess : function(response) {var responseView = new ResponseView(response);app.changePage(responseView);}});window.CashOutInquiryForm = Backbone.View.extend({initialize : function(config) {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#baseForm', this.el).append(addHiddenField({name : PARAMETER_TRANSACTIONNAME,value : TRANSACTION_CASHOUT_INQUIRY})+addHiddenField({name : PARAMETER_SERVICE_NAME,value : SERVICE_WALLET})+addHiddenField({name : PARAMETER_SRC_POCKET_CODE,value : config.sourcePocketCode})+addHiddenField({name : PARAMETER_SOURCE_MDN,value : app.user.get(PARAMETER_SOURCE_MDN)})+addField({label : "Agent Code",name : PARAMETER_AGENT_CODE,type : "text",required : true,validations:true})+addField({label : "Amount",name : PARAMETER_AMOUNT,type : "text",required : true,validations:true})+addField({label : "PIN",name : PARAMETER_SOURCE_PIN,type : "password",required : true,validations:true})+addButton({id : "Submit",value : "CashOut",type : "submit",inline : true}));$('#logout', this.el).remove();this.events=getEvents({'click #logout' : 'logout','click #home' : 'home','click #back' : 'back','submit form' : 'submit'},{'touchstart #logout' : 'logout','touchstart #home' : 'home','touchstart #back' : 'back','submit form' : 'submit'});},render : function(eventName) {return this;},logout : function(e) {app.logout();},home : function(e) {app.menu();},back : function(e) {var menu = new AccountMenu();app.changePage(menu);},submit : function() {if( $('#baseForm').valid()){var self = this;var data = $('#baseForm').serialize();sendRequest(data, self);}return false;},onSuccess : function(response) {if (response.data.code == CODE_TRANSFERINQUIRY_SUCCESS) {app.response.set(response.data);var cashoutConfirmation = new CashOutConfirmationForm();app.changePage(cashoutConfirmation);} else {var responseView = new ResponseView(response);app.changePage(responseView);}}});window.CashOutConfirmationForm = Backbone.View.extend({initialize : function() {this.template = _.template(tpl.get('basepage'));$(this.el).html(this.template());$('#baseForm', this.el).append(addHiddenField({name : PARAMETER_TRANSACTIONNAME,value : TRANSACTION_CASHOUT})+addHiddenField({name : PARAMETER_SERVICE_NAME,value : app.request.get(PARAMETER_SERVICE_NAME)})+addHiddenField({name : PARAMETER_SOURCE_MDN,value : app.user.get(PARAMETER_SOURCE_MDN)})+addHiddenField({name:PARAMETER_TRANSFER_ID,value:app.response.get(PARAMETER_TRANSFER_ID)})+addHiddenField({name:PARAMETER_PARENTTXN_ID,value:app.response.get(PARAMETER_PARENTTXN_ID)})+addHiddenField({name : PARAMETER_AGENT_CODE,value : app.request.get(PARAMETER_AGENT_CODE)}));var confirm ="<center><br><b> AgentCode\n </b>"+app.request.get(PARAMETER_AGENT_CODE)+"<br><b> Amount\n </b>"+app.response.get(PARAMETER_CREDIT_AMT)+"<br><b> Charge\n </b>"+app.response.get(PARAMETER_CHARGES)+"</center>";$('#baseForm', this.el).append(confirm);$('#baseForm', this.el).append(addButton({id:"confirm",value:"Confirm",type:"submit",inline:true})+addButton({id:"cancel",value:"Cancel",inline:true}));$('#logout', this.el).remove();this.events=getEvents({'click #logout' : 'logout','click #home' : 'home','click #cancel' : 'cancel','submit form' : 'submit'},{'touchstart #logout' : 'logout','touchstart #home' : 'home','touchstart #cancel' : 'cancel','submit form' : 'submit'});},render : function(eventName) {return this;},logout : function(e) {app.logout();},home : function(e) {app.menu();},cancel:function(e){var self = this;var data = $('#baseForm').serialize();data = data+"&confirmed="+CONSTANT_VALUE_FALSE;sendRequest(data,self);},submit : function() {var self = this;var data = $('#baseForm').serialize();data = data + "&confirmed="+CONSTANT_VALUE_TRUE;sendRequest(data, self);return false;},onSuccess : function(response) {var responseView = new ResponseView(response);app.changePage(responseView);}});var AppRouter = Backbone.Router.extend({routes:{"":"main"},initialize:function () {$('.back').live('click', function(event) {return false;});this.request = new Request();this.response = new Response();this.user = new User();},main:function () {var menu =  new IndexMenuPage();this.changePage(menu);},menu :function(){if(this.user.has(PARAMETER_SOURCE_MDN)){if(this.user.get("type")==USER_SUBSCRIBER){this.subscriberMenu();}else if(this.user.get("type")==USER_AGENT){this.agentMenu();}}else{this.main();}},subscriberMenu:function () {var menu =  new SubscriberMenu();this.changePage(menu);},agentMenu:function(){var menu =  new AgentMenu();this.changePage(menu);},logout:function(){sendLogoutRequest();},changePage:function (page) {disablePage();$(page.el).attr('data-role', 'page');$('body').append($(page.el));$.mobile.changePage($(page.el), {changeHash:false, transition: 'none'});setLayout();}});$(document).ready(function() {tpl.loadConfig('MANIFEST.MF',function() {tpl.loadTemplates([ 'basepage' ], function() {app = new AppRouter();Backbone.history.start();});});isTouchDevice = 'ontouchstart' in document.documentElement;});